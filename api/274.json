{"title":"一个显示最新评论的wordpress插件","zzzContent":"用法:将deskor_comments.php传到wp-contents/plugins目录，然后在插件管理中激活。\n在需要显示最新评论的地方，比发themes/你的风格名称/sitebar.php中加:\n<coolcode lang=\"php\">\n<?php\n/**\n25是调用最新评论的条数。\n先判断一下是否已经包含了插件文件，函数是否存在，免得出错。\n*/\nif(function_exists (\"get_deskor_comments\"))\n get_deskor_comments(25);\n?>\n</coolcode>\ndeskor_comments.php文件的内容:\n<coolcode lang=\"php\">\n<?php\n/*\nPlugin Name: deskor_comments\nPlugin URI: http://www.162cm.com\nDescription: 一个显示最新评论的插件<br/>调用方法:在需要显示的地方写上:<?php get_deskor_deskor_comments(10);?>\nAuthor: renlu xu <helloasp@hotmail.com>\nVersion: 1.0\nAuthor URI: http://www.162cm.com\n*/\n\n\nfunction get_deskor_comments($count=10)\n{\n\tglobal $wpdb;\n\t $res=$wpdb->get_results(\"SELECT * FROM $wpdb->comments order by comment_ID  DESC limit \".$count);\n\t foreach($res as $row)\n\t {\n\n\t \techo \"<li>\";\n\t \techo \"<a href=\"\".get_permalink($row->comment_post_ID).\"#comment-\".$row->comment_ID.\"\">[\";\n\t \techo $row->comment_author.\"]says(\".xoops_substr($row->comment_content,0,45);\n\t \techo \")</a></li>\";\n\n\t }\n}\n\n\n\n\n\t/**\n\t截取函数，从xoops中挪过来的.\n\t*/\n\tfunction xoops_substr($str, $start, $length, $trimmarker = '...')\n{\n\n    if (function_exists('mb_internal_encoding') && @mb_internal_encoding(_CHARSET)) {\n        $str2 = mb_strcut( $str , $start , $length - strlen( $trimmarker ) );\n        return $str2 . ( mb_strlen($str)!=mb_strlen($str2) ? $trimmarker : '' );\n    }\n    // phppp patch\n    $DEP_CHAR=127;\n    $pos_st=0;\n    $action = false;\n    for ( $pos_i = 0; $pos_i < strlen($str); $pos_i++ ) {\n        if ( ord( substr( $str, $pos_i, 1) ) > 127 ) {\n            $pos_i++;\n        }\n        if ($pos_i<=$start) {\n            $pos_st=$pos_i;\n        }\n        if ($pos_i>=$pos_st+$length) {\n            $action = true;\n            break;\n        }\n    }\n    return ($action) ? substr( $str, $pos_st, $pos_i - $pos_st - strlen($trimmarker) ) . $trimmarker : $str;\n}\n\n\n\n?>\n</coolcode>","postDate":"2006-10-06 12:27:05","postId":274,"type":"post","status":"publish","imported":true,"file":"274.md"}