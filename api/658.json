{"title":"社区全文检索引擎Hyper Estraier 学习笔记[3]","zzzContent":"经过摸索，我决定给HyperEstraier加上由Hightman写的scws支持，使之支持中文分词。\n实地看了代码之后，发现Hyperestraier的结构划分并不好，这可能决定了他只能是某些Hacker的心血之作，而不适用多人协作开发，大规模推广应用。这是旁话。\n既然找到分词默认是使用的estraier.c的est_break_text函数，那我的目标就是改造这个函数,现在这个函数被我改成了:\n<coolcode lang=\"C\">\nscws_t seg;\n/* Break a sentence of text and extract words. */\nvoid est_break_text(const char *text, CBLIST *list, int norm, int tail){\n// hack by renlu.xu\n  CBLIST *words;\n  const unsigned char *word, *next;\n  unsigned char *utext;\n  char *tmp;\n  int i, j, k, size, cc, wsiz, nsiz, tsiz;\n  assert(text && list);\n\tif(seg==NULL)\n\t{\n\t\tseg=scws_new();\n\t\tscws_set_charset(seg,\"UTF-8\");\n\t\tscws_set_rule(seg,\"/home/y/etc/rules.utf8.ini\");\n\t\tint xmode=0;\n\t\tscws_set_dict(seg,\"/home/y/etc/dict.xdb\",(xmode & XMODE_DICT_MEM) ? SCWS_XDICT_MEM : SCWS_XDICT_XDB);\n\t\tif(seg->d == NULL && !(xmode & XMODE_NO_TIME))\n        fprintf(stderr, \"WARNING: input dict file load failed. /home/y/etc/dict.xdbn\");\n\n\t}\n\tint fsize;\n    fsize=strlen(text);\n    scws_send_text(seg,text,fsize);\n\tscws_res_t res,cur;\n\twhile ((cur = res = scws_get_result(seg))!= NULL)\n\t{\n\t\twhile (cur != NULL)\n\t\t{\n\t\t\tcblistpush(list,text+cur->off,cur->len);\n\t\t\tcur = cur->next;\n\t\t}\n\t\tscws_free_result(res);\n\t}\n\tint iter_i;\n\tint wsize=0;\n\tfprintf(stderr,\"nsegmented words:n\");\n\tfor(iter_i=0;iter_i<cblistnum(list);iter_i++){\n\t\tword=CB_LISTVAL2(list,iter_i,wsize);\n\t\tfprintf(stderr,\"%st\",word);\n\t}\n\treturn ;\n }\n</coolcode>\nOk,其中函数中最后一个for语句是为了调试，看看分词结果如何。\n这里用到的scws_send_text等函数是hightman的scws中定义的，因此需要在estraier.c的文件头加上:\n<coolcode>\n#include \"scws.h\"\n</coolcode>\n并修改Hyperestraier的Makefile:\n<coolcode>\n LIBS = -lqdbm -lz -lm -lc  -lscws\n</coolcode>\n然后make && make install\n下面作个测试:\n<coolcode>\n#!/bin/sh\n#file:test.sh\nrm -rf test_db\nestcmd create test_db\nfind ./ -name \"1.txt\" -type f |estcmd gather -cl -fm -cm test_db -\nestcmd search -vx -max 10 test_db '索引'\n</coolcode>\n根据打印的结果，中文分词已经加入到索引过程中去了!\n\n<a href=\"http://www.162cm.com/archives/426.html\">社区全文检索引擎Hyper Estraier 学习笔记[1]</a><br/>\n<a href=\"http://www.162cm.com/archives/657.html\">社区全文检索引擎Hyper Estraier 学习笔记[2]</a><br/>\n<a href=\"http://www.162cm.com/archives/658.html\">社区全文检索引擎Hyper Estraier 学习笔记[3]</a><br/>","postDate":"2008-06-22 12:26:13","postId":658,"type":"post","status":"publish","imported":true,"file":"658.md"}