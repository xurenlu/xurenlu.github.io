{"title":"Apache的Mod_rewrite的配置学习笔记","zzzContent":"<pre>\nmodrewrite配置文档学习笔记:\n\n1.环境变量:\n\n\t例子:\n\n\tSCRIPT_NAME=/sw/lib/w3s/tree/global/u/rse/.www/index.html\n\tSCRIPT_FILENAME=/u/rse/.www/index.html\n\tSCRIPT_URL=/u/rse/\n\tSCRIPT_URI=http://en1.engelschall.com/u/rse/\n\n2:RewriteBase\n\t描述：设定基于目录的重写规则的Base url.\n\tSyntax:\tRewriteBase URL-path\n\tContext:\tdirectory, .htaccess\n\tOverride:\tFileInfo\n\tStatus:\tExtension\n\tModule:\tmod_rewrite\n\t这个一般不太需要管它.\n3.RewriteCond\n\t用法:\tRewriteCond Teststring Pattern\n\t这里是Teststring里用到的一些内置变量.\n\tHTTP headers:\tconnection & request:\n\tHTTP_USER_AGENT\n\tHTTP_REFERER\n\tHTTP_COOKIE\n\tHTTP_FORWARDED\n\tHTTP_HOST\n\tHTTP_PROXY_CONNECTION\n\tHTTP_ACCEPT\n\tREMOTE_ADDR\n\tREMOTE_HOST\n\tREMOTE_PORT\n\tREMOTE_USER\n\tREMOTE_IDENT\n\tREQUEST_METHOD\n\tSCRIPT_FILENAME\n\tPATH_INFO\n\tQUERY_STRING\n\tAUTH_TYPE\n\n\tDOCUMENT_ROOT\n\tSERVER_ADMIN\n\tSERVER_NAME\n\tSERVER_ADDR\n\tSERVER_PORT\n\tSERVER_PROTOCOL\n\tSERVER_SOFTWARE\n\tTIME_YEAR\n\tTIME_MON\n\tTIME_DAY\n\tTIME_HOUR\n\tTIME_MIN\n\tTIME_SEC\n\tTIME_WDAY\n\tTIME\n\tAPI_VERSION\n\tTHE_REQUEST\n\tREQUEST_URI\n\tREQUEST_FILENAME\n\tIS_SUBREQ\n\tHTTPS\n\n\n\t#你可以在规则前加\"!\"取反.\n\t#这是一些常见的特殊的规则。你可以使用他们来取代一些表达式:\n\n\t* '<condPattern'\n    * '>CondPattern' (lexicographically follows)\n    * '=CondPattern' (lexicographically equal)\n    * '-d' (is directory)  测试是否是目录.\n    * '-f' (is regular file) 测试是否是常规文件.\n    * '-s' (is regular file, with size)\n    * '-l' (is symbolic link)\n    * '-F' (is existing file, via subrequest)\n    * '-U' (is existing URL, via subrequest)\n\n\t你可以为规则后设置[flags]选项作为第三个参数.常见的有:\n\tYou can also set special flags for CondPattern by appending [flags]  as the third argument to the RewriteCond  directive, where flags is a comma-separated list of any of the following flags:\n\n\t# 'nocase|NC' (no case)\n\t# 'ornext|OR' (or next condition)\n\t例如:\n\tRewriteCond %{REMOTE_HOST}  ^host1.*  [OR]\n\tRewriteCond %{REMOTE_HOST}  ^host2.*  [OR]\n\tRewriteCond %{REMOTE_HOST}  ^host3.*\n\tRewriteRule ...some special stuff for any of these hosts...\n\n\t如下例:\n\tRewriteCond  %{HTTP_USER_AGENT}  ^Mozilla.*\n\tRewriteRule  ^/$                 /homepage.max.html  [L]\n\n\tRewriteCond  %{HTTP_USER_AGENT}  ^Lynx.*\n\tRewriteRule  ^/$                 /homepage.min.html  [L]\n\n\tRewriteRule  ^/$                 /homepage.std.html  [L]\n\t用Mozilla类的浏览器访问时会带你到homepage.max.html,这里支持所有特性。用Lynx来浏览时，带你到纯文本页(homepage.min.html),默认情况下会访问一个叫homepage.std.html的页.\n\n\n\n4.RewriteEngine:\n\t使用:\n\tRewriteEngine On|Off\n\t如果存在.htaccess的文件，应当显式地指明RewriteEngine On.\n\t因为默认情况下.htaccess的RewriteEngine项是Off的。因此如果想用.htaccess来设置rewrite,文件头一行一般都需要RewriteEngine On\n\n5.RewriteLock:\n\t供rewrite-mapping程序同步使用的锁文件。\n\t使用:\n\tRewriteLock file-path\n\n6.RewriteLog:\n\t设定日志文件.如果不是以\"/\"开头，则是指相对ServerRoot的相对路径.\n\t使用:\n\tRewriteLog\tfile-path\n\n7.RewriteLogLevel:\n\t设定日志记录级别。\n\t使用:\n\tRewriteLogLevel level\n\t默认:\n\n8.RewriteMap:\n\t使用Mapping.\n\t它的上下文是Server config 和Virtual host\n\t使用:\n\tRewriteMap Mapname MapType:Mapsource\n\t例如:\n\t在httpd.conf中配置:\n\t#RewriteMap exampleMap txt:/path/to/file/map.txt\n\t#RewriteRule ^/ex/(.*)\t${exampleMap:$1}\n\t而map文件的格式有这个几个:\n\t1.txt类型的map文件:\n\t\t#Standard Plain\t txt:\n\t\t#map.txt\n\t\t#maptype:txt\n\t\tRalf.S.Engelschall    rse   # Bastard Operator From Hell\n\t\tMr.Joe.Average        joe   # Mr. Average\n\n\t2.Randomized Plain Text\n\t\t#maptyp:rnd\n\t\tstatic\twww1|www2|www3|www4\n\t\tdynamic\twww5|www6\n\n\t\t配置:\n\t\tRewriteMap servers\trnd:/path/to/mapfile/map.txt\n\t\tRewriteRule ^/(.*.(png|gif|jpg)) http://${servers:static}/$1\t[NC,P,L]\n\t\tRewriteRule ^/(.*)\thttp://${servers:dynamic}/$1\t[P,L]\n\n\t3.dbm\n\t\t这里提供了一个txt2dmb程序。\n\t\t!/path/to/bin/perl\n\t\t##\n\t\t##  txt2dbm -- convert txt map to dbm format\n\t\t##\n\n\t\tuse NDBM_File;\n\t\tuse Fcntl;\n\n\t\t($txtmap, $dbmmap) = @ARGV;\n\n\t\topen(TXT, \"<$txtmap\") or die \"Couldn't open $txtmap!n\";\n\t\ttie (%DB, 'NDBM_File', $dbmmap,O_RDWR|O_TRUNC|O_CREAT, 0644)\n\t\t  or die \"Couldn't create $dbmmap!n\";\n\n\t\twhile (<txt>) {\n\t\t  next if (/^s*#/ or /^s*$/);\n\t\t  $DB{$1} = $2 if (/^s*(S+)s+(S+)/);\n\t\t}\n\n\t\tuntie %DB;\n\t\tclose(TXT);\n\n\t\t用法:\n\t\t$ txt2dbm map.txt map.db\n\n\t4.内置函数:\n\t\tmap:int map-source:internal apache functions\n\t\tfunctions有:toupper,tolower,escape,unescape\n\n\t5.外部程序:\n\t\tmaptyp:prg map source:外部程序的路径.\n\t\t示例:\n\t\t#!/usr/bin/perl\n\t\t$| = 1;\n\t\twhile (<stdin>) {\n\t\t\t# ...put here any transformations or lookups...\n\t\t\tprint $_;\n\t\t}\n\n\n9.RewriteOptions\n\t用法:\n\tRewriteOptions rewriteoptions\n\tdefault\t:\n\trewriteoptions\tmaxRedirects=10\n\t上下文:\n\tserver config,virtual host,.htaccess directory\n\trewriteoptions可以是下面两个值:\n\tinherit:从上一级配置继承.\n\tMaxRedirects=num(10,15,,,,,等等)\n\n\n10.RewriteRule:\n\t这是mod_rewrite中用得最多的语句了(\"the real rewriting workhorse\");\n\t用法:\n\tRewriteRule pattern Substitution [Flags]\n\n\tQuantifiers:\n\t  ?           0 or 1 occurrences of the preceding text\n\t  *           0 or N occurrences of the preceding text (N > 0)\n\t  +           1 or N occurrences of the preceding text (N > 1)\n\n\tGrouping:\n\t  (text)      Grouping of text\n\t\t\t\t  (used either to set the borders of an alternative as above, or\n\t\t\t\t  to make backreferences, where the Nth group can\n\t\t\t\t  be referred to on the RHS of a RewriteRule as $N)\n\n\tAnchors:\n\t  ^           Start-of-line anchor\n\t  $           End-of-line anchor\n\n\tEscaping:\n\t  char       escape the given char\n\t\t\t\t  (for instance, to specify the chars \".[]()\" etc.)\n\n\t一些技巧:\n   1.  back-references ($N) to the RewriteRule pattern\n   2. back-references (%N) to the last matched RewriteCond pattern\n   3. server-variables as in rule condition test-strings (%{VARNAME})\n   4. mapping-function calls (${mapname:key|default})\n\n\t关于Flags:\n\t# 'chain|C' (chained with next rule)\n\t# 'cookie|CO=NAME:VAL:domain[:lifetime[:path]]' (set cookie)\n\t# 'env|E=VAR:VAL' (set environment variable)\n\t# 'forbidden|F' (force URL to be forbidden)\n\t# 'gone|G' (force URL to be gone)\n\t# 'last|L' (last rule)\n\t# 'next|N' (next round)\n\t# 'nocase|NC' (no case)\n\t# 'noescape|NE' (no URI escaping of output)\n\t例如:\n\tRewriteRule /foo/(.*) /bar?arg=P1%3d$1 [R,NE]\n\t这将会将'/foo/zed' 转向到'/bar?arg=p1=zed'\n\t# 'nosubreq|NS' ( not for internal sub-requests)\n\t# 'proxy|P' (force proxy)\n\n\tNote: mod_proxy must be enabled in order to use this flag.\n\t# 'passthrough|PT' (pass through to next handler)\n\t(例如:\n\tRewriteRule ^/abc(.*) /def$1 [PT]\n\tAlias /def /ghi\n\n\t# 'qsappend|QSA' (query string append)\n\t# 'redirect|R [=code]' (force redirect)\n\t# 'skip|S=num' (skip next rule(s))\n\t# 'type|T=MIME-type' (force MIME type)\n\n\n\n</pre>","postDate":"2007-04-29 21:23:24","postId":404,"type":"post","status":"publish","imported":true,"file":"404.md"}