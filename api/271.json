{"title":"一个产生SQL的类","zzzContent":"主要是觉得每次都写sql语句麻烦，比较喜欢ASP中的那种写法，于是自己写了一个.\n<coolcode lang=\"php\">\n<?php\n\nclass sqlGeneretaor{\n\t/**\n\t产生插入语句\n\t$insert是这样的数组:\n\t$insert[\"id\"]=127;\n\t$insert[\"userpass\"]=(\"admin\");\n\n\n\t产生一个这样的SQL:\n\tinsert *** (id,userpass) values(127,'admin')';\n\t*/\n function insert($tablename,$insertColumns,$debug=false){\n \t \tarray_map(mysql_escape_string,$insertColumns);\n\t\t$insertSql=\"INSERT INTO `$tablename` (\";\n\t\t$keys=array_keys($insertColumns);\n\t\twhile(list($k,$v)=each($keys))\n\t\t$keys[$k]=\"`\".mysql_escape_string($v).\"`\";\n\t\t$values=array_values($insertColumns);\n\t\twhile(list($k,$v)=each($values))\n\t\t$values[$k]=\"'\".mysql_escape_string($v).\"'\";\n\t\t$insertSql.=join(\",\",$keys).\") VALUES (\".join(\",\",$values).\")\";\n\t\treturn $insertSql;\n\t}\n\t/**\n\t产生删除语句\n\tkeycolumns是这样的数组:\n\t$key[0][\"columnname\"]=\"uid\";\n\t$key[0][\"var\"]=27;\n\t$key[0][\"condition\"]=\"equal\";\n\n\t$key[1][\"columnname\"]=\"username\";\n\t$key[1][\"var\"]=\"example\";\n\t$key[1][\"condition\"]=\"equal\"\n\n\n\t产生一个这样的SQL:\n\tdelete from ****  where uid=27 and username='example';\n\t*/\n\tfunction delete($tablename,$keyColumns)\n\t{\n\n\t\t$deleteSql=\"delete from `$tablename` \";\n\t\t$tempArr=array();\n\t\tif(sizeof($keyColumns)>0)\n\t\t{\n\t\t\twhile (list($k,$v)=each($keyColumns)) {\n\t\t\t\t$columnNameStr=$v[\"columnname\"];\n\t\t\t\t$conditionStr=$v[\"condition\"];\n\t\t\t\t$var=$v[\"var\"];\n\n\t\t\t\tswitch (strtoupper($conditionStr))\n\t\t\t\t{\n\t\t\t\t\tcase \"MORE\":\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`>\".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`>'\".$var.\"'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"LESS\":\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`<\".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`<'\".$var.\"'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"LIKE\":\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` LIKE \".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` LIKE '%\".$var.\"%'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tdefault:\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` = \".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` = '\".$var.\"'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t\t$deleteSql.=\" WHERE \".join(\" AND \",$tempArr);\n\t\t}\n\t\treturn $deleteSql;\n\t}\n\t/**\n\t产生修改语句\n\tkeycolumns是这样的数组:\n\t$key[0][\"columnname\"]=\"uid\";\n\t$key[0][\"var\"]=27;\n\t$key[0][\"condition\"]=\"equal\";\n\n\t$key[1][\"columnname\"]=\"username\";\n\t$key[1][\"var\"]=\"example\";\n\t$key[1][\"condition\"]=\"equal\"\n\n\t$updatecolumns是这样的数组:\n\t$update[\"id\"]=127;\n\t$update[\"userpass\"]=(\"admin\");\n\n\n\t产生一个这样的SQL:\n\tupdate **** set id=127,userpass='admin' where uid=27 and username='example';\n\t*/\n\t function update($updateColumns,$tablename,$keyColumns)\n\t{\n\t\tarray_map(mysql_escape_string,$updateColumns);\n\n\t\t$updateSql=\"update `$tablename` set \";\n\t\t$columns=array();\n\t\twhile(list($k,$v)=each($updateColumns))\n\t\t{\n\t\t\t$columns[]=\"`\".$k.\"`='\" .$v.\"'\";\n\t\t}\n\t\t$updateSql.=join(\",\",$columns);\n\t\t$tempArr=array();\n\t\tif(sizeof($keyColumns)>0)\n\t\t{\n\n\t\t\twhile (list($k,$v)=each($keyColumns)) {\n\t\t\t\t$columnNameStr=$v[\"columnname\"];\n\t\t\t\t$conditionStr=$v[\"condition\"];\n\t\t\t\t$var=$v[\"var\"];\n\n\t\t\t\tswitch (strtoupper($conditionStr))\n\t\t\t\t{\n\t\t\t\t\tcase \"MORE\":\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`>\".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`>'\".$var.\"'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"LESS\":\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`<\".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`<'\".$var.\"'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"LIKE\":\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` LIKE \".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` LIKE '%\".$var.\"%'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tdefault:\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` = \".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` = '\".$var.\"'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t\t$updateSql.=\" WHERE \".join(\" AND \",$tempArr);\n\t\t}\n\t\treturn $updateSql;\n\t}\n\t/**\n\t产生查询语句\n\tselectColumns是这样形式的数组:\n\t$sel=array(\"userid,username,userpass\");表示查userid,usernaem,userpass三项。\n\tkeycolumns是这样的数组:\n\t$key[0][\"columnname\"]=\"uid\";\n\t$key[0][\"var\"]=27;\n\t$key[0][\"condition\"]=\"equal\";\n\n\t$key[1][\"columnname\"]=\"username\";\n\t$key[1][\"var\"]=\"example\";\n\t$key[1][\"condition\"]=\"equal\"\n\n\t产生一个这样的SQL:\n\tselect userid,username,userpass from *** where uid=27 and username='example';\n\t*/\n\n\t function select($tablename,$selectColumns,$keyColumns,$orders,$limitStatement)\n\t{\n\t\t$selectSql=\"SELECT \";\n\t\t$tempArr=array();\n\t\twhile (list($k,$v)=each($selectColumns))\n\t\t{\n\t\t\t$tempArr[]=$v;\n\t\t}\n\t\t$selectSql.=join(\",\",$tempArr).\" FROM $tablename \";\n\t\t$tempArr=array();\n\t\tif(sizeof($keyColumns)>0)\n\t\t{\n\t\t\twhile (list($k,$v)=each($keyColumns)) {\n\t\t\t\t$columnNameStr=$v[\"columnname\"];\n\t\t\t\t$conditionStr=$v[\"condition\"];\n\t\t\t\t$var=$v[\"var\"];\n\n\t\t\t\tswitch (strtoupper($conditionStr))\n\t\t\t\t{\n\t\t\t\t\tcase \"MORE\":\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`>\".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`>'\".$var.\"'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"LESS\":\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`<\".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`<'\".$var.\"'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"NOT\":\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`!=\".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"`!='\".$var.\"'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"LIKE\":\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` LIKE \".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` LIKE '%\".$var.\"%'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tdefault:\n\t\t\t\t\t{\n\t\t\t\t\t\tif(is_array($var))\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` = \".\"`\".$var.\"`\";\n\t\t\t \t\t\telse\n\t\t\t \t\t\t\t$tempArr[]=\"`\".$columnNameStr.\"` = '\".$var.\"'\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t\t$selectSql.=\" WHERE \".join(\" AND \",$tempArr);\n\n\t\t}\n\t\t$tempArr=array();\n\t\tif(sizeof($orders)>0)\n\t\t{\n\t\t\tforeach ($orders as $arr)\n\t\t\t{\n\t\t\t\t$tempArr[]=\" `\".$arr[\"ordercolumn\"].\"` \".$arr[\"ordertype\"];\n\t\t\t}\n\t\t\t$selectSql.=\" ORDER BY \".join(\" , \",$tempArr).\" \";\n\t\t}\n\t\t$selectSql.=\" \".$limitStatement;\n\t\treturn $selectSql;\n\t}\n}\n\n?>\n</coolcode>","postDate":"2006-10-05 19:40:53","postId":271,"type":"post","status":"publish","imported":true,"file":"271.md"}