{"title":"如何利用script标签构建跨域ajax","zzzContent":"要解决ajax跨域问题,网上给出的方法有二:\n1是构建服务器端的代理。简而言之，就是ajax中调用的实质还是本机的url,而服务器端替js去取回远端地址。\n2.利用script标记，生成一个<script src=\"....\"></script>标签。在js加载完成后，再执行后续操作。\n就是将原来新建xmlHTTPrequest对象的操作改成了新建script标签的操作.\n 这里给出一个例子:\n #ajah.js\n        <coolcode>\n        var  Ajah=function(url,varname,handleSuccess,handleFailure){\n        /**\n        * handleSuccess,handleFailure must be functions\n        * */\n        script = document.createElement(\"script\");\n        script.src=url;\n        var handler = function(str)\n        {\n                handleSuccess(str);\n        }\n        script.onload = function()\n        {\n                var json=eval(varname);\n                handler(json);\n        }\n        if(window.ie)\n        {\n                script.onreadystatechange = function()\n                {\n                        if(script.readyState=='complete'||script.readyState== 'loaded')\n                        {\n                                var json=eval(varname);\n                                if(typeof json != 'undefined')\n                                {\n                                        handler(json);\n                                }\n                        }\n                }\n        }\n        document.body.appendChild(script);\n}\n        </coolcode>\n而在网页中应这样调用:\n        #demo.html\n        <coolcode>\n<pre>\n        <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 3.2//EN\">\n<html>\n<head>\n  <meta name=\"generator\" content=\n  \"HTML Tidy for Linux (vers 1 September 2005), see www.w3.org\">\n\n  <title></title>\n        <script src=\"mootools.js\"></script>\n        <script src=\"ajah.js\"></script>\n</head>\n\n<body>\n<script>\nvar ajah=new Ajah(\"data.js\",\"json198\",function(str){\n        console.debug(\"returned:\");\n        console.debug(str);\n},\nfunction(str){});\n</script>\n</body>\n</html>\n</pre>\n        </coolcode>\n        被调用的数据文件如下\n  #data.js\n        <coolcode>\nvar json198=\"hello,this is json198\";\n        </coolcode>\n        funciton Ajah(url,varname,handleSuccess,handleFailure){...}\n        Ajah这个构造函数调用四个参数:\n        url:远端地址\n        varname:远端返回数据的变量名\n        handleSuccess:加载完毕后加载的函数\n        handleFailure:暂时没用上\n        </coolcode>","postDate":"2008-04-18 09:02:42","postId":621,"type":"post","status":"publish","imported":true,"file":"621.md"}