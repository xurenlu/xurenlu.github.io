{"title":"一段读取BT Torrent文件的代码。。。。请勿转载","zzzContent":"晚上突然看到了自己以前做BT站的计划，于是写了这么一段代码：\n<coolcode lang=\"php\">\n<?php\n   $fp=fopen(\"铁血.torrent\",\"rb\");\n\t/**\n\t读文件内容\n\t*/\n\twhile(!feof($fp)) {\n           if($data=fread($fp,1024)){\n                     $filestr.=$data;\n               }\n    }\n\tfclose($fp);\n\n\tprint_r(dictionary::nextStep($filestr));\n\n\tclass dictionary{\n\t\t/**\n\t\t得到解析出来的串\n\t\t*/\n\t\tvar $VARS;\n\t\t/**\n\t\t得到一个串，并移动字符串指针\n\t\t*/\n\t\tfunction &getNextString($string)\n\t\t{\n\t\t\t$array=array();\n\t\t\t$pos=strpos($string,\":\");\n\t\t\t$array[0]=substr($string,0,$pos);\n\t\t//\techo \"<<<<< \".$pos.\">>>\";\n\t\t\t$len=intval($array[0]);\n\t\t\t$array[1]=substr($string,$pos);\n\t\t\t$returnValue=substr($array[1],1,$len);\n\t\t\t$string=substr($string,$len+strlen($array[0])+1);\n\t\t\treturn $returnValue;\n\t\t}\n\t\tfunction &getNextInteger($string)\n\t\t{\n\n\t\t    $a=\"i\";\n\t\t    $b=\"e\";\n\t\t\t$start=strpos($string,$a);\n\t\t\t$end=strpos($string,$b);\n\t\t\t$integer= substr($string,$start+1,$end-$start-1);\n\t\t\t$string=substr($string,$end+1);\n\t\t\treturn $integer;\n\n\t\t}\n\t\tfunction getStringFromAtoB($string,$a,$b)\n\t\t{\n\t\t\t$start=strpos($string,$a);\n\t\t\t$end=strpos($string,$b);\n\t\t\treturn  substr($string,$start+1,$end-$start-1);\n\t\t}\n\t\tfunction &nextStep($str)\n\t\t{\n\t\t\t/**\n\t\t\t返回值的含议：\n\t\t\te:结束一个列表或字典\n\t\t\ti:开始一个整数\n\t\t\t任一数字：开始一个字符串\n\t\t\t*/\n\n\t\t\t$gotoNext=true;\n\t\t\twhile($gotoNext)\n\t\t\t{\n\t\t\t\tif(!strlen($str))\n\t\t\t\t{\n\t\t\t\t\t$gotoNext=false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t$firstChar=substr($str,0,1);\n\t\t\t\tswitch($firstChar){\n\t\t\t\tcase \"1\":\n\t\t\t\tcase \"2\":\n\t\t\t\tcase \"3\":\n\t\t\t\tcase \"4\":\n\t\t\t\tcase \"5\":\n\t\t\t\tcase \"6\":\n\t\t\t\tcase \"7\":\n\t\t\t\tcase \"8\":\n\t\t\t\tcase \"9\":\n\t\t\t\tcase \"0\":\n\t\t\t\t{\n\t\t\t\t\t$VARS[]=dictionary::getNextString(&$str);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"i\":\n\t\t\t\t{\n\t\t\t\t\t$VARS[]=dictionary::getNextInteger(&$str);\n\t\t\t\t}\n\t\t\t\tcase \"e\":\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase \"l\":\n\t\t\t\tcase \"d\":\n\t\t\t\t{\n\t\t\t\t\t$str=substr($str,1);\n\t\t\t\t\t$VARS[]=(dictionary::nextStep(substr($str,0,512)));\n\t\t\t\t//\t$VARS[]=dictionary::nextStep($str);\n\t\t\t\t\t$gotoNext=false;\n\t\t\t\t\t//$this->VARS[]=$this->nextStep($str);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\t$str=substr($str,1);\n\t\t\t\t\t$gotoNext=false;\n\t\t\t\t\tbreak;\n\t\t\t\t}//switch\n\t\t\t}//while\n\t\t\treturn $VARS;\n\n\t\t}\n\t}\n\t?>\n</coolcode>\n\n最后可以返回一个这样的数组，这样就可以得到比如bt文件的文件名等等数据了。\n<coolcode>\nArray\n(\n    [0] => Array\n        (\n            [0] => announce\n            [1] => http://tracker.icefish.org:8080/announce\n            [2] => created by\n            [3] => BitComet/0.59\n            [4] => creation date\n            [5] => 1161189890\n            [6] => encoding\n            [7] => GBK\n            [8] => info\n            [9] => Array\n                (\n                    [0] => length\n                    [1] => 408471635\n                    [2] => name\n                    [3] => [bt.icefish.org]tonightlady20061017.rm\n                    [4] => name.utf-8\n                    [5] => [bt.icefish.org]tonightlady20061017.rm\n                    [6] => piece length\n                    [7] => 262144\n                    [8] => pieces\n                    [9] => ??** 注，这里是块数据，是二进制的，所以乱码很正常。。\n             )\n\n        )\n\n)\n\n</coolcode>","postDate":"2006-10-19 23:16:09","postId":286,"type":"post","status":"publish","imported":true,"file":"286.md"}