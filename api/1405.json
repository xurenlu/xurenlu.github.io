{"title":"Drill:关系数据库查询","zzzContent":"Apache Drill支持查询某些RDBMS实例。这使得您能将您的传统数据库连接到你的Drill集群中来，您将能够用一个系统中用同一个视图来处理关系数据库和NO-SQL 数据库。\n\n不管是哪一种源，Drill都支持在系统内和多个系统之间进行Join。这包括在一些关系数据库上进行对像join,where,group 这样的语句的推演。\n\n<h2>使用关系数据库插件</h2>\n\nDrill设计生来就可以和提供了JDBC 驱动的关系数据库一起工作。Drill在Postgres,MySQL,Oracle, MSSQL和Apache Derby 上进行了活跃的测试。针对每一个系统，你都只需要三个基础的步骤来进行启动：\n\n<ul>\n<li>安装Drill,如果您还没有安装的话；</li>\n<li>把该数据库的JDBC驱动拷贝到jars/3rdparty 目录下（每个节点都需要这么做）</li>\n<li>通过WEB UI给Drill添加新插件的配置。Oracle,SQL Server,Mysql和Postgres的例子马上给出。</li>\n</ul>\n\n<h2>示例：和MySQL 一起工作</h2>\n\nDrill使用您从WEB UI或是REST API设定的插件配置，通过JDBC 驱动来和MySQL 通信。\n\n<strong>在您配置插件之前，请确保Mysql 的服务已经启来了，并且jar文件已经拷贝在指定目录了。</strong>\n\n###    配置JDBC插件的方法:\n\n<ul>\n<li>启动Drill ;</li>\n<li>打开Drill WEB控制台；</li>\n<li>在Storage Tab页，在\"New Storage Plugin\"区域键入一个名字，例如:<code>myplugin</code>。Drill里面注册的每一个插件都需要一个唯一的名字，名字是大小写敏感的。</li>\n<li>点击“Create\"。</li>\n<li>在配置区域，像下面这样，用JSON格式来设置属性。请做必要的修改，以匹配你自己的实际环境。</li>\n</ul>\n\n<pre><code>{\n  \"type\": \"jdbc\",\n  \"driver\": \"com.mysql.jdbc.Driver\",\n  \"url\": \"jdbc:mysql://localhost:3306\",\n  \"username\": \"root\",\n  \"password\": \"mypassword\",\n  \"enabled\": true\n}  \n\n</code></pre>\n\n<ul>\n<li>点击\"Create\"。</li>\n</ul>\n\n你可以使用performance_schema数据库来访问随着Mysql安装的performance_schema数据库。请在Where子句里，用小圆点连接插件配置，数据库，表名这种语法；就像下面给出来的一样:\n\n<pre><code>0: jdbc:drill:zk=local&gt; select * from myplugin.performance_schema.accounts;\n  +--------+------------+----------------------+--------------------+\n  |  USER  |    HOST    | CURRENT_CONNECTIONS  | TOTAL_CONNECTIONS  |\n  +--------+------------+----------------------+--------------------+\n  | null   | null       | 18                   | 20                 |\n  | jdoe   | localhost  | 0                    | 813                |\n  | root   | localhost  | 3                    | 5                  |\n  +--------+------------+----------------------+--------------------+\n  3 rows selected (0.171 seconds)\n</code></pre>\n\n<h2>Oracle 配置示例</h2>\n\n下载并将ojdbc7.12.1.0.2.jar 安装到您 的每个Drill节点上:\n\n<pre><code>{\n  type: \"jdbc\",\n  enabled: true,\n  driver: \"oracle.jdbc.OracleDriver\",\n  url:\"jdbc:oracle:thin:user/password@1.2.3.4:1521/ORCL\"\n}\n</code></pre>\n\n<h2>SQL Server的示例配置</h2>\n\n对于SQL Server,Drill已经测试过微软的 sqljdbc41.4.2.6420.100.jar 驱动。将这个文件拷贝到所有的Drill节点上。\n\n<strong>您需要在JDBC的连接字符串中提供数据库的名字，以帮助Drill识别MSSQL 协议。</strong>\n\n<pre><code>{\n  type: \"jdbc\",\n  enabled: true,\n  driver: \"com.microsoft.sqlserver.jdbc.SQLServerDriver\",\n  url:\"jdbc:sqlserver://1.2.3.4:1433;databaseName=mydatabase\",\n  username:\"user\",\n  password:\"password\"\n}\n</code></pre>\n\n<h2>MySQL 的配置示例</h2>\n\n对于MySQL,Drill已经在 mysql-connector-java-5.1.37-bin.jar  这个驱动上测试过。把它拷贝到所有的Drill节点上。\n\n<pre><code>{\n  type: \"jdbc\",\n  enabled: true,\n  driver: \"com.mysql.jdbc.Driver\",\n  url:\"jdbc:mysql://1.2.3.4\",\n  username:\"user\",\n  password:\"password\"\n}\n</code></pre>\n\n<h2>Postgres 配置示例</h2>\n\n对于Postgres,Drill测试过 9.1-901-1.jdbc4  驱动（近期的版本应该都可以）；拷贝这个jar到所有的Drill节点上。\n\n<pre><code>{\n  type: \"jdbc\",\n  enabled: true,\n  driver: \"org.postgresql.Driver\",\n  url:\"jdbc:postgresql://1.2.3.4/mydatabase\",\n  username:\"user\",\n  password:\"password\"\n}\n</code></pre>","postDate":"2017-04-04 16:02:43","postId":1405,"type":"post","status":"publish","imported":true,"file":"1405.md"}