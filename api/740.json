{"title":"Mysql做主从同步(replication)","zzzContent":"哈，原来手里有一份教程， 每次做同步都照做，一直很顺利。这次很久没做同步了，竟然不会了。折腾了好久，特地做个笔记。\n<coolcode>\nMysql 同步笔记\n1.a为主，b为从.\na的ip:10.62.240.128\nb的ip:10.62.240.126\n\na,b 两台机器均装好Mysql,同时确保配置文件中\ncharacter_set_server                = utf8\ncollation_server                    = utf8_unicode_ci\n两台机器的设置相同。\n\n2.在主(a)上配置:\n[/etc/my.cnf]中mysqld域新增:\nlog-bin\nserver-id       = 1\nsql-bin-update-same\nbinlog-do-db    = database_name\n3.在从机器中配置:\nmaster-host=10.62.240.128          #a的ip\nmaster-user=replication\nmaster-password=replication\nmaster-port=3306\nserver-id=2\nmaster-connect-retry=60\nreplicate-do-db=database_name\nlog-slave-updates\n4.授权:在a上面进入mysql:\nGRANT REPLICATION SLAVE ON *.* TO 'replication'@'10.62.240.126' IDENTIFIED BY 'replication';\nflush privileges;\n5.锁定a:\nmysql> use database_name;\nmysql>FLUSH TABLES WITH READ LOCK; #锁定要同步的test表，然后导出数据结构\nmysql>show master status;#记录这里的结果。记录如下:\nmysqld-bin.000003 |  1399444 | reping       |\nmysqldump database_name > dump.sql\nmysql> UNLOCK TABLES;                         #已做好同步数据库结构导出后，解锁这个表\n\n6.在b(从)中载入sql:\nmysql -uroot < dump.sql\n7:在b中对replication位置进行设定:\nmysql>change master to master_host='10.62.240.128', master_port=3306, master_user='replication',master_password='replication',master_log_file='mysqld-bin.000003', MASTER_LOG_POS=1399444;\n\nmysql>start slave;#启动复制服务\n8:检查主和从之间的同步是否已经跟上:\n在a中运行mysql>show master status;\nmysql> show master status;\n+-------------------+----------+--------------+------------------+\n| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB |\n+-------------------+----------+--------------+------------------+\n| mysqld-bin.000003 |  5614301 | reping       |\n再在从中运行msyql> show  slave status;\nshow slave statusG\n*************************** 1. row ***************************\n             Slave_IO_State: Waiting for master to send event\n                Master_Host: 10.62.240.128\n                Master_User: replication\n                Master_Port: 3306\n              Connect_Retry: 60\n            Master_Log_File: mysqld-bin.000003\n        Read_Master_Log_Pos: 5614301\n             Relay_Log_File: mysqld-relay-bin.000001\n              Relay_Log_Pos: 4214905\n      Relay_Master_Log_File: mysqld-bin.000003\n           Slave_IO_Running: Yes\n          Slave_SQL_Running: Yes\n            Replicate_Do_DB:\n        Replicate_Ignore_DB:\n         Replicate_Do_Table:\n     Replicate_Ignore_Table:\n    Replicate_Wild_Do_Table:\nReplicate_Wild_Ignore_Table:\n                 Last_Errno: 0\n                 Last_Error:\n               Skip_Counter: 0\n        Exec_Master_Log_Pos: 5614301\n            Relay_Log_Space: 4214905\n            Until_Condition: None\n             Until_Log_File:\n              Until_Log_Pos: 0\n         Master_SSL_Allowed: No\n         Master_SSL_CA_File:\n         Master_SSL_CA_Path:\n            Master_SSL_Cert:\n          Master_SSL_Cipher:\n             Master_SSL_Key:\n      Seconds_Behind_Master: 0\n1 row in set (0.01 sec)\n\n\n注意read_master_log_pos也是5614301,说明复制成功。\n以后复制出问题时，也是用这种方式查看和修改。那种查入一条记录然后看从库中是不是也执行了的办法，不可取。\n</coolcode>","postDate":"2008-11-25 18:29:07","postId":740,"type":"post","status":"publish","imported":true,"file":"740.md"}