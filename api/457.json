{"title":"用ab来做性能测评好像不公平吧?","zzzContent":"我的师兄,从某种程度上说也是我php方面的师父,和他的同事做了测评,分别是针对php4,php5的性能对比和function,class的性能对比的。\n<a href=\"http://chin.bokee.com/6398886.html\" target=\"_blank\">这里是师兄的对比结果</a>\n<a href=\"http://soft.zdnet.com.cn/software_zone/2007/0806/446249.shtml\" target=\"_blank\">师兄的同事做的测评</a>\n但是我不认为用ab来做出的测试是合理的.理由:用ab来测试时,结果好像总似是在跳舞一样.做为证据,我将我的notebook依文本方式重启,用ab来测lighttpd的表现.\n具体环境:\nHaier H40S Notebook\nRAM:1.5G\nCPU:CY 1.6GHz\n硬盘:60G,(具体型号什么的不清楚,列个60G表示不是SCSI硬盘)\nOS:Fedora Core 7.0(Moonshine)\nweb server:lighttpd 1.4.15\n测试工具:ab\nX环境:未运行X server\n命令:ab -n 10000 -c 50 http://localhost:8181/\n第一份结果:\n<coolcode>\nThis is ApacheBench, Version 2.0.40-dev &lt;$Revision: 1.146 $&gt; apache-2.0\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nCopyright 2006 The Apache Software Foundation, http://www.apache.org/</coolcode>\n\nBenchmarking localhost (be patient)\n\nServer Software:        lighttpd/1.4.15\nServer Hostname:        localhost\nServer Port:            8181\n\nDocument Path:          /\nDocument Length:        345 bytes\n\nConcurrency Level:      50\nTime taken for tests:   1.786830 seconds\nComplete requests:      10000\nFailed requests:        0\nWrite errors:           0\nNon-2xx responses:      10000\nTotal transferred:      4980000 bytes\nHTML transferred:       3450000 bytes\nRequests per second:    5596.50 [#/sec] (mean)\nTime per request:       8.934 [ms] (mean)\nTime per request:       0.179 [ms] (mean, across all concurrent requests)\nTransfer rate:          2721.58 [Kbytes/sec] received\n\nConnection Times (ms)\nmin  mean[+/-sd] median   max\nConnect:        0    3   2.6      4       8\nProcessing:     1    4   0.7      5       6\nWaiting:        0    1   1.7      2       5\nTotal:          5    8   2.2      8      13\nWARNING: The median and mean for the processing time are not within a normal deviation\nThese results are probably not that reliable.\n\nPercentage of the requests served within a certain time (ms)\n50%      8\n66%     10\n75%     10\n80%     11\n90%     11\n95%     12\n98%     12\n99%     12\n100%     13 (longest request)\n\n这里的结果是Requests per second:    5596.50 [#/sec] (mean)(插一句,lighttpd的性能真是好,用apache从来没上过3000)\n第二份ab -n 10000 -c 50的结果:\n<coolcode>\nThis is ApacheBench, Version 2.0.40-dev &lt;$Revision: 1.146 $&gt; apache-2.0\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nCopyright 2006 The Apache Software Foundation, http://www.apache.org/</coolcode>\n\nBenchmarking localhost (be patient)\n\nServer Software:        lighttpd/1.4.15\nServer Hostname:        localhost\nServer Port:            8181\n\nDocument Path:          /\nDocument Length:        345 bytes\n\nConcurrency Level:      50\nTime taken for tests:   1.313719 seconds\nComplete requests:      10000\nFailed requests:        0\nWrite errors:           0\nNon-2xx responses:      10011\nTotal transferred:      4985478 bytes\nHTML transferred:       3453795 bytes\nRequests per second:    7611.98 [#/sec] (mean)\nTime per request:       6.569 [ms] (mean)\nTime per request:       0.131 [ms] (mean, across all concurrent requests)\nTransfer rate:          3705.51 [Kbytes/sec] received\n\nConnection Times (ms)\nmin  mean[+/-sd] median   max\nConnect:        0    1   1.0      1       5\nProcessing:     1    5   2.0      5      32\nWaiting:        0    3   1.8      3      30\nTotal:          1    6   2.1      6      35\n\nPercentage of the requests served within a certain time (ms)\n50%      6\n66%      6\n75%      6\n80%      6\n90%      7\n95%      8\n98%     10\n99%     11\n100%     35 (longest request)\n\n结果表明RPS是Requests per second:    7611.98 [#/sec] (mean).\n第三份结果:\n<coolcode>\nThis is ApacheBench, Version 2.0.40-dev &lt;$Revision: 1.146 $&gt; apache-2.0\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nCopyright 2006 The Apache Software Foundation, http://www.apache.org/</coolcode>\n\nBenchmarking localhost (be patient)\n\nServer Software:        lighttpd/1.4.15\nServer Hostname:        localhost\nServer Port:            8181\n\nDocument Path:          /\nDocument Length:        345 bytes\n\nConcurrency Level:      50\nTime taken for tests:   1.300247 seconds\nComplete requests:      10000\nFailed requests:        0\nWrite errors:           0\nNon-2xx responses:      10009\nTotal transferred:      4984482 bytes\nHTML transferred:       3453105 bytes\nRequests per second:    7690.85 [#/sec] (mean)\nTime per request:       6.501 [ms] (mean)\nTime per request:       0.130 [ms] (mean, across all concurrent requests)\nTransfer rate:          3743.14 [Kbytes/sec] received\n\nConnection Times (ms)\nmin  mean[+/-sd] median   max\nConnect:        0    1   1.0      1       5\nProcessing:     1    4   1.4      5      11\nWaiting:        0    2   1.1      3       8\nTotal:          1    6   1.2      6      14\n\nPercentage of the requests served within a certain time (ms)\n50%      6\n66%      6\n75%      6\n80%      6\n90%      7\n95%      9\n98%     10\n99%     11\n100%     14 (longest request)\n\nRPS结果是Requests per second:    7690.85 [#/sec] (mean).\n第四份结果是:\n<coolcode>\nThis is ApacheBench, Version 2.0.40-dev &lt;$Revision: 1.146 $&gt; apache-2.0\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nCopyright 2006 The Apache Software Foundation, http://www.apache.org/</coolcode>\n\nBenchmarking localhost (be patient)\n\nServer Software:        lighttpd/1.4.15\nServer Hostname:        localhost\nServer Port:            8181\n\nDocument Path:          /\nDocument Length:        345 bytes\n\nConcurrency Level:      50\nTime taken for tests:   1.315784 seconds\nComplete requests:      10000\nFailed requests:        0\nWrite errors:           0\nNon-2xx responses:      10033\nTotal transferred:      4996434 bytes\nHTML transferred:       3461385 bytes\nRequests per second:    7600.03 [#/sec] (mean)\nTime per request:       6.579 [ms] (mean)\nTime per request:       0.132 [ms] (mean, across all concurrent requests)\nTransfer rate:          3708.06 [Kbytes/sec] received\n\nConnection Times (ms)\nmin  mean[+/-sd] median   max\nConnect:        0    1   1.2      1       8\nProcessing:     1    4   1.4      5      11\nWaiting:        0    2   1.1      3       8\nTotal:          1    6   1.4      6      15\n\nPercentage of the requests served within a certain time (ms)\n50%      6\n66%      6\n75%      6\n80%      6\n90%      7\n95%      9\n98%     11\n99%     12\n100%     15 (longest request)\n\n结果是Requests per second:    7600.03 [#/sec] (mean).\n第五份结果是:\n<coolcode>\nThis is ApacheBench, Version 2.0.40-dev &lt;$Revision: 1.146 $&gt; apache-2.0\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nCopyright 2006 The Apache Software Foundation, http://www.apache.org/</coolcode>\n\nBenchmarking localhost (be patient)\n\nServer Software:        lighttpd/1.4.15\nServer Hostname:        localhost\nServer Port:            8181\n\nDocument Path:          /\nDocument Length:        345 bytes\n\nConcurrency Level:      50\nTime taken for tests:   1.812989 seconds\nComplete requests:      10000\nFailed requests:        0\nWrite errors:           0\nNon-2xx responses:      10000\nTotal transferred:      4980000 bytes\nHTML transferred:       3450000 bytes\nRequests per second:    5515.75 [#/sec] (mean)\nTime per request:       9.065 [ms] (mean)\nTime per request:       0.181 [ms] (mean, across all concurrent requests)\nTransfer rate:          2682.31 [Kbytes/sec] received\n\nConnection Times (ms)\nmin  mean[+/-sd] median   max\nConnect:        0    3   2.7      4       9\nProcessing:     1    4   0.8      5       6\nWaiting:        0    1   1.7      2       5\nTotal:          5    8   2.3      9      13\nWARNING: The median and mean for the processing time are not within a normal deviation\nThese results are probably not that reliable.\n\nPercentage of the requests served within a certain time (ms)\n50%      9\n66%     10\n75%     10\n80%     11\n90%     12\n95%     12\n98%     12\n99%     12\n100%     13 (longest request)\n\nRPS结果是Requests per second:    5515.75 [#/sec] (mean);\n\n可以看到,同是ab -n 10000 -c 50 http://localhost:8181/,结果大不一样,不仅分为7600RPS和5500RPS两档,而各档中具体数据也不一样.这个结果可以理解,OS中总是会有各种各样的消息要处理,影响具体数据结果也很正常.\n因此,谢华亮(sir?mm?)的测试用ab的结果来进行php4,php5的性能比较是不太对的.至少目前看来,我没有从他的文章中看到他进行了多次ab测评后取结果的平均值.但是他列出来这样一个结果:\n<coolcode>\n版本\t函数测试\t不实例化类\t实例化类\t类的继承\nPHP 4.4.2\t1047.23/rps\t\t1034.98/rps\t\t1006.14/rps\t\t992.95/rps\nPHP 5.2.1\t1176.06/rps\t\t1197.17/rps\t\t 1187.93/rps\t1128.54/rps\n</coolcode>\n这大致可以说明,php5.2确实是比php4.4.2要快.但是从1197.17&gt;1176.06得出php5的类跑得比functiong还快,我不这么认为.只是21个request的差别,太小了,ab测试的随便一个风吹草吹就行了(而且说class比function要快,严重地伤害了我的感情,哈哈)...\n嗯,先整这么多.有空好好研究一下,如何对web程序进行性能测评.\n另外,有空见到这两位兄台,好好争论一番.","postDate":"2007-08-21 23:47:14","postId":457,"type":"post","status":"publish","imported":true,"file":"457.md"}