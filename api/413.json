{"title":"Mysql server tuning(译文)","zzzContent":"从某个英文pdf文档译过来的,很久了，还是Mysql Conference 2007时的PDF.\n(如果能找到，我把原文地址和pdf给出来)\n向原作者致谢....\n\n调整Server Config时需要考虑的事情\n设置是针对负载的，不存在说有什么针对一个16GB内存的优化方案这种说法.\n存储引擎的选择或是混用是很重要的\n有些设置取决于您的硬件和操作系统。\n\n\nApproaching?tuning\n您只需要设置一部分，其余的一些要具体分析（这些也很难决定如何去调整）\n有些设置会影响Mysql的行为和安全，要小心\n有些设置是可以基于连接的，利用这一点!\n首先优化您的查询，否则您需要重新检阅您的设置。\n常见错误:\n运行默认设置。（当然如果您用来在您的本儿上存您的DVD收集资料， 那当然可以）\n直接使用其他人的My.conf文件，都没检查一下是否符合您的需求。\n虽然只有一两个查询需要，您仍为它设置了一个巨大的全局设置。您可以这样：\nSET sort_buffer_size=128000000;\n\nset sort_buffer_size=DEFAULT\n\n我们能得到的信息：\nSHOW STATUS\nSHOW INNODB STATUS\n操作系统的命令比如：vmstat,iostat,mpstat\n\n\n\n使用内存:\n为Mysql server分配更多内存常常带来显著的性能提升.\n但是分配过多的内存会损失性能甚至是稳定性\n检查一下：\nSwapping\n查看swap IO ，这比简单地使用swap space要好\n使用了32位以上的地址(确保OS和mysql server都是64位的)\n\n战胜Swapping\n有些操作系统会使用Swap,虽然内存充足。\n处理好IO cache和swap间的平衡。\n设置VM子系统为只有在最后一次使用resort的时候才swap\ntune VM subsystem to use swap only as last resort\necho 1 >/proc/sys/vm/swappiness\n如果在linux上使用innodb可以用直接磁盘IO:\ninnodb_flush_method=O_DIRECt\n\n了解一下变量的单位：\ntable_cache=128M\n错了，它的单位是用个(entries)来衡量的。\nkey_buffer_size=1024\n错了，key buffer size要用bytes来设定。\ninnodb_max_dirty_pages_pct=8GB\n这个设置准确无误。\n\n了解作用域和内存分配规则\nkey_buffer_size\n全局的，由所有线程共用。\nsort_buffer_size\n需要排序时将内存分配给线程。\nread_buffer_size:\n一次性就分配指定大小的内存，虽然可能更小的内存就够了\n过大的值反而会让事情慢得糟糕\n更多的分配常常由OS来完成。\ntmp_table_size:\n指定一个最大值，在需要的时候会增长到这个值 。\n调得过大也没什么事\n\n\n细节:\n关于SHOW STATUS\nshow global status:了解服务器的全局状态。了解负载的好方法。在Mysql4.1和以下版本中唯一一个。\nshow local status:\n查询/会话配置的好东西\n从mysql 5.0开始能用\nshow status 默认就是这个\n有些变量是全局的\n也出现会在show status 的输出中\nmysqladmin extended -i100 -r\n抽样一下，看看Mysql server现在干了些什么，这是个好办法\nShow status:\naborted clients:\n不用担心，许多程序都没有恰当地关闭连接。\naborted_connects:\n可能意味着认证失败，网络超时或其他错误。\n值得看一看，因为可能引起主机blocked out\nmax_connect_errors=100000\n可能意味着有人尝试暴力密码破解\nbinlog_cache_disk_use/binlog_cache_use\nbin log 溢出到磁盘的频率。\n如果太频繁，需要增大--binlog_cache_size\ncom_xxx:\n按查询来了解服务器负载\n查询可以是相当复杂多样的","postDate":"2007-06-29 04:08:21","postId":413,"type":"post","status":"publish","imported":true,"file":"413.md"}