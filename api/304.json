{"title":"xoops:article模块加入所见即所得功能支持(用TinyMCE)","zzzContent":"article模块加入所见即所得功能支持:\nXoops的内核加入了对Form表单各个种类的封装，这个设计是简化了一些程序设计工作，但是其众多的Form class往往让人头晕。\nxoops自带的Koivi，Dhtml编辑器都不怎么出色，很难直接投入商业运用，因此许多人尝试进行Hack.\n今天跟霍炬聊的时候，他的话给了我信心，仔细看了代码，发现其实还是不太难的。\n下面和我一起做。\n我用的Xoops为XOOPS 2.015,artcile模块为0.96.这里系统自带的有三个编辑器，Textarea,koivi,dhtml.在\nxoopsFrameworksxoops22classxoopseditor 中可以看到。\n我在xoopsFrameworksxoops22classxoopseditortextareatextarea.php中加入这样一个类:\n<coolcode lang=\"PHP\">\n<?php\nclass XoopsFormTextAreaJsWithTinyMCE extends XoopsFormTextArea{\n\tvar $js=\"/xoops/js/tiny_mce/tiny_mce.js\";\n\tvar $script=\"<script language=\"javascript\"\ntype=\"text/javascript\">n\ttinyMCE.init({n\nmode : \"exact\",n\t\ttheme : \"advanced\",n\n\telements : \"text,elm2\",n\t\tplugins :\n\"table,save,advhr,advimage,advlink,emotions,iespell,insertdatetime,\npreview,zoom,media,searchreplace,print,contextmenu,paste,\ndirectionality,fullscreen\",n\ntheme_advanced_buttons1_add_before :\n\"save,newdocument,separator\",n\ntheme_advanced_buttons1_add : \"fontselect,fontsizeselect\",n\t\ttheme_advanced_buttons2_add : \"separator,insertdate,inserttime,preview,zoom,\nseparator,forecolor,backcolor\",n\ntheme_advanced_buttons2_add_before: \"cut,copy,paste,pastetext,pasteword,separator,\nsearch,replace,separator\",n\ntheme_advanced_buttons3_add_before :\n\"tablecontrols,separator\",n\ntheme_advanced_buttons3_add : \"emotions,iespell,media,advhr,separator,print,\nseparator,ltr,rtl,separator,fullscreen\",n\n\ttheme_advanced_toolbar_location : \"top\",n\t\ttheme_advanced_toolbar_align :\n \"left\",n\t\ttheme_advanced_statusbar_location : \"bottom\",n\n\tcontent_css : \"example_word.css\",n\n\t    plugi2n_insertdate_dateFormat : \"%Y-%m-%d\",n\t    plugi2n_insertdate_timeFormat : \"%H:%M:%S\",n\n\t\texternal_link_list_url : \"example_link_list.js\",n\nexternal_image_list_url : \"example_image_list.js\",n\n\t\tmedia_external_list_url : \"example_media_list.js\",n\t\tfile_browser_callback : \"fileBrowserCallBack\",n\n\t\tpaste_use_dialog : false,n\ntheme_advanced_resizing : true,n\ntheme_advanced_resize_horizontal : false,n\n\ttheme_advanced_link_targets : \"_something=My somthing;_something2=My somthing2;_something3=My somthing3;\",n\n\tpaste_auto_cleanup_on_paste : true,n\t\tpaste_convert_headers_to_strong : false,n\t\tpaste_strip_class_attributes : \"all\",n\n\tpaste_remove_spans : false,n\npaste_remove_styles : false\t\tn\t});nn\nfunction fileBrowserCallBack(field_name, url, type, win) {n\n\t\t// This is where you insert your custom filebrowser logicn\t\talert(\"Filebrowser callback: field_name: \" + field_name + \",\nurl: \" + url + \", type: \" + type);nn\n// Insert new URL, this would normaly be done in a popupn\nwin.document.forms[0].elements[field_name].value = \"someurl.htm\";n\n\t}n</script>\";\n\tfunction render()\n\t{\n\t\treturn \"<script src='\".$this->js.\"' >\n</script>\".$this->script.\"<textarea name='\".$this->getName().\"'\nid='\".$this->getName().\"' rows='\".$this->getRows().\"' cols=\n'\".$this->getCols().\"'\".$this->getExtra().\">\".$this->getValue().\"\n</textarea>\";\n\t}\n}\n?>\n</coolcode>\n\n\n然后我们把class FormTextArea extends XoopsFormTextArea 改成\nclass FormTextArea extends XoopsFormTextAreaJsWithTinyMCE。哈哈，现在成功了。\n不过这样也只有当编辑在发布文章选择textarea这个编辑器时才有用，选了koivi和DHTML时还是不行。这也容易，我们把\nxoopsmodulesarticleincludeform.article.php中的\n<coolcode>$form_art->addElement(new XoopsFormSelectEditor($form_art,\"editor\",$editor,$nohtml));</coolcode>这一行去掉。这样用户就没得选择了。然后我们把默认编辑器设成textarea:\n找到\n<coolcode>$form_art->addElement(new XoopsFormEditor(art_constant(\"MD_TEXT\"), $editor, $editor_configs, $nohtml, $onfailure=null));</coolcode>\n这一行，把$editor改为\"textarea\",ok了，系统不管什么时候都会使用TinyMCE.\n当然，您看到了，在Xoops/js目录下加上TinyMCE这个目录。这个您自个儿Google一下 然后去tinyMCE官方网站去下吧。","postDate":"2006-11-03 17:58:42","postId":304,"type":"post","status":"publish","imported":true,"file":"304.md"}