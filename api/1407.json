{"title":"Drill:文件系统插件","zzzContent":"你可以配置一个存储插件，来让Drill连接到一个本地文件系统，或是在Hadoop的core-site.xml里注册过的分布式文件系统，像是S3或是HDFS。默认情况下，Drill都提供了一个叫dfs的插件配置，指向了您的本地文件系统。\n\n<h2>连接Drill到一个文件系统</h2>\n\n在一个Drill集群中，您一般不会查询一个本地文件系统，而是将文件放在分布式文件系统中。当前阶段，您连接到多个Drill终端时，为了得到一致的，完整的查询结果，通常都需要一个分布式的文件系统 ，这个可能是通过将文件拷贝到所有的节点来模拟，或是使用NFS，也或者是使用Amazon的弹性云系统。\n\n您 要在插件的工作空间中配置connection 属性，这样Drill才能连接到分布式文件系统；例如，下面的配置可以让Drill从一个客户端连接到HDFS集群:\n\n<pre><code>\"connection\": \"hdfs://&lt;IP Address&gt;:&lt;Port&gt;/\"\n</code></pre>\n\n在集群中，要从一台机器查询HDFS上的文件，你只需要简单地将dfs插件中的connection属性中的\"file:///\"改成\"hdfs://\"就行了。\n\n要修改dfs插件的配置来指向不同的本地或分布式文件系统，像下面这样使用connection属性就好了\n\n<ul>\n<li>本地文件系统的例子:</li>\n</ul>\n\n<pre><code>{\n    \"type\": \"file\",\n    \"enabled\": true,\n    \"connection\": \"file:///\",\n    \"workspaces\": {\n      \"root\": {\n        \"location\": \"/user/max/donuts\",\n        \"writable\": false,\n        \"defaultInputFormat\": null\n       }\n    },\n    \"formats\" : {\n      \"json\" : {\n        \"type\" : \"json\"\n      }\n    }\n  }\n</code></pre>\n\n分布式文件系统的例子:\n\n<pre><code>{\n    \"type\" : \"file\",\n    \"enabled\" : true,\n    \"connection\" : \"hdfs://10.10.30.156:8020/\",\n    \"workspaces\" : {\n      \"root\" : {\n        \"location\" : \"/user/root/drill\",\n        \"writable\" : true,\n        \"defaultInputFormat\" : null\n      }\n    },\n    \"formats\" : {\n      \"json\" : {\n        \"type\" : \"json\"\n      }\n    }\n  }\n\n</code></pre>\n\n要连接到Hadoop的文件系统，你要将name node的IP和端口写在配置中。\n\n<h2>甜甜圈例子</h2>\n\n下面的例子展示了一个file类型的插件，还带有一个叫json_files的工作空间。这个配置将Drill指向到了本机的/users/max/drill/json/目录（dfs)。\n\n<pre><code>{\n  \"type\" : \"file\",\n  \"enabled\" : true,\n  \"connection\" : \"file:///\",\n  \"workspaces\" : {\n    \"json_files\" : {\n      \"location\" : \"/users/max/drill/json/\",\n      \"writable\" : false,\n      \"defaultInputFormat\" : json\n   } \n},\n</code></pre>\n\n配置里的\"connection\"选项是\"file:///\",将Drill连接到了本地的文件系统 。\n\n要查询示例的json_files工作空间里的文件，你可以使用USE指令来告诉Drill使用json_files工作空间，这个工作空间是指定在dfs插件里的。\n\n<pre><code>USE dfs.json_files;\nSELECT * FROM `donuts.json` WHERE type='frosted'\n</code></pre>\n\n如果json_files 工作空间不存在，查询就需要像下面这样指定完整的路径:\n\n<pre><code>SELECT * FROM dfs.`/users/max/drill/json/donuts.json` WHERE type='frosted';\n</code></pre>","postDate":"2017-04-04 16:03:07","postId":1407,"type":"post","status":"publish","imported":true,"file":"1407.md"}