{"title":"REPLACE INTO 为什么返回\"2 rows affected\"","zzzContent":"表的结构:\n<coolcode>\n desc urls;\n+-------+---------------------+------+-----+---------+-------+\n| Field | Type                | Null | Key | Default | Extra |\n+-------+---------------------+------+-----+---------+-------+\n| id    | bigint(16) unsigned | NO   | PRI | NULL    |       |\n| url   | varchar(255)        | NO   |     | NULL    |       |\n| md516 | varchar(32)         | NO   | UNI |         |       |\n+-------+---------------------+------+-----+---------+-------+\n3 rows in set (0.01 sec)\n\n</coolcode>\n原有数据:\n<coolcode >\n+----+-----------------------+------------------+\n| id | url                   | md516            |\n+----+-----------------------+------------------+\n|  0 | http://www.162cm.com/ | 49f6f2aaa26c124a |\n+----+-----------------------+------------------+\n1 row in set (0.00 sec)\n</coolcode>\n执行的语句:\n<coolcode>\nREPLACE INTO urls (`url`,`md516`,`id`) VALUES ('http://www.162cm.com/','49f6f2aaa26c124a',0);\n</coolcode>\n而执行这条语句的返回是:\n<coolcode>\nQuery OK, 2 rows affected (0.00 sec)\n</coolcode>\n为啥呢....看起来数据啥也没变，不是吗?\n看文档:<a href=\"http://au2.php.net/mysql_affected_rows\">http://au2.php.net/mysql_affected_rows</a>:\n<blockquote>\n Returns the number of affected rows on success, and -1 if the last query failed.\n\nIf the last query was a DELETE query with no WHERE clause, all of the records will have been deleted from the table but this function will return zero with MySQL versions prior to 4.1.2.\n\nWhen using UPDATE, MySQL will not update columns where the new value is the same as the old value. This creates the possibility that mysql_affected_rows() may not actually equal the number of rows matched, only the number of rows that were literally affected by the query.\n\nThe REPLACE statement first deletes the record with the same primary key and then inserts the new record. This function returns the number of deleted records plus the number of inserted records.\n</blockquote>\n","postDate":"2009-06-29 17:15:51","postId":909,"type":"post","status":"publish","imported":true,"file":"909.md"}